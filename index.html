<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지침 없이 모델 테스트</title>
    <style>
        body { font-family: sans-serif; margin: 20px; line-height: 1.6; }
        #responseArea {
            border: 1px solid #ccc;
            padding: 15px;
            min-height: 150px; /* 응답 공간 확보 */
            margin-bottom: 15px;
            white-space: pre-wrap; /* 공백 및 줄바꿈 유지 */
            word-wrap: break-word; /* 긴 단어 자동 줄바꿈 */
            background-color: #f8f8f8;
            color: #333;
            overflow-y: auto; /* 내용 많아지면 스크롤 */
            max-height: 400px; /* 최대 높이 설정 */
        }
        #inputArea { display: flex; gap: 10px; }
        #userInput {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }
        #sendButton {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        #sendButton:hover {
            background-color: #0056b3;
        }
        #sendButton:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Gemini API 직접 테스트</h1>
    <p>아래 입력창에 메시지를 입력하고 '보내기' 버튼을 눌러보세요. 백엔드 API로 **시스템 지침이나 이전 대화 기록 없이 오직 현재 메시지만** 보냅니다.</p>
    <div id="responseArea">여기에 API 응답이 표시됩니다...</div>
    <div id="inputArea">
        <input type="text" id="userInput" placeholder="테스트 메시지 입력...">
        <button id="sendButton">보내기</button>
    </div>

    <script>
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const responseArea = document.getElementById('responseArea');

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) {
                responseArea.textContent = '메시지를 입력해주세요.';
                return;
            }

            sendButton.disabled = true; // 버튼 비활성화
            responseArea.textContent = 'API 요청 중...'; // 로딩 표시

            try {
                // --- 핵심: 시스템 지침 및 대화 기록 없이 오직 사용자의 현재 메시지만 포함 ---
                const contentsForApi = [{
                    role: "user",
                    parts: [{ text: message }]
                }];
                // --------------------------------------------------------------------

                const res = await fetch('/api/chat', {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: contentsForApi }),
                });

                if (!res.ok) {
                    // HTTP 상태 코드가 200번대가 아니면 오류 처리
                    const errorText = await res.text(); // 응답 본문을 텍스트로 읽음
                    console.error("API Error:", res.status, errorText);
                    responseArea.textContent = `API 오류 발생: ${res.status} - ${errorText}`;
                } else {
                    // 응답이 성공적이라면 JSON으로 파싱 시도
                    const data = await res.json();
                    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "(응답 내용 없음)";
                    responseArea.textContent = `응답: \n${reply}`; // 응답 표시
                }

            } catch (error) {
                // 네트워크 오류 등 fetch 자체에서 발생한 오류 처리
                console.error("Fetch Error:", error);
                responseArea.textContent = `통신 중 오류 발생: ${error}`;
            } finally {
                sendButton.disabled = false; // 버튼 다시 활성화
            }
        }
    </script>
</body>
</html>