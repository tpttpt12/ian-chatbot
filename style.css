body {
            font-family: "Nanum Gothic", sans-serif; /* 나눔고딕 폰트 적용 */
            background-color: #1E1E1E;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* 레이아웃 개선을 위한 컨테이너 스타일 수정 */
        .app-container {
             display: flex;
             flex-direction: column;
             height: 100%;
             width: 95%; /* 너비를 일단 넓게 설정 */
             max-width: 900px; /* 최대 너비 설정 (대략 1500px 화면에서 60% 정도 느낌) */
             margin: 0 auto; /* 좌우 자동 마진으로 중앙 정렬 */
             background-color: #1e1e1e; /* 배경색 유지 */
             /* 불필요한 그림자/테두리 제거 */
             box-shadow: none;
             border: none;
             position: relative;
             overflow: hidden; /* 컨테이너 내부 내용 넘침 방지 */
        }
         /* 화면이 충분히 넓을 때 너비를 60%로 조정 */
         @media (min-width: 1200px) {
             .app-container {
                 width: 60%;
             }
         }


        .chat-header {
            background-color: 1E1E1E;
            color: #ffffff;
            padding: 1rem;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            /* border-bottom: 1px solid #3a3a3a; */ /* 구분선 제거 */
            flex-shrink: 0;
            position: relative;
            display: flex;
             justify-content: center;
             align-items: center;
        }

        #sidebarToggle {
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            width: 35px;
            height: 35px;
            background-color: #5a5a5a;
            color: #ffffff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease;
            z-index: 10;
        }
         #sidebarToggle:hover {
             background-color: #6a6a6a;
         }

#chat {
            flex: 1;
            padding: 1rem;
            overflow-y: auto; /* 스크롤은 되지만 스크롤바 숨김 */
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            /* 스크롤바 숨김 */
             scrollbar-width: none; /* Firefox */
             -ms-overflow-style: none; /* IE and Edge */
             background-color: #1e1e1e;
         }
        /* Webkit 브라우저용 스크롤바 숨김 */
        #chat::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        /* 기존 스크롤바 스타일은 이제 필요 없으므로 제거하거나 주석 처리합니다. */
        /*
        #chat::-webkit-scrollbar-track { background: #1E1E1E; }
        #chat::-webkit-scrollbar-thumb {
            background-color: #5a5a5a;
            border-radius: 4px;
            border: 2px solid #1E1E1E;
        }
        */

        .message-container {
            display: flex;
            align-items: flex-start;
            max-width: 85%;
        }

        .message-container.user {
            justify-content: flex-end;
            margin-left: auto;
        }

        .message-container.bot {
            justify-content: flex-start;
            margin-right: auto;
        }

        .profile-img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid #5a5a5a;
            flex-shrink: 0;
        }

         .profile-fallback {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #5a5a5a;
            border: 1px solid #5a5a5a;
            flex-shrink: 0;
        }

        .message-container.bot .profile-img,
        .message-container.bot .profile-fallback {
            margin-right: 0.75rem;
        }

        .message-container.user .profile-img,
        .message-container.user .profile-fallback {
            margin-left: 0.75rem;
        }

        .message-content-wrapper {
            display: flex;
            flex-direction: column;
            /* 역할에 따라 정렬 */
        }

        /* 유저 메시지일 때 contentWrapper를 오른쪽으로 정렬 */
        .message-container.user .message-content-wrapper {
            align-items: flex-end;
        }

         /* 캐릭터 메시지일 때 contentWrapper를 왼쪽으로 정렬 */
        .message-container.bot .message-content-wrapper {
            align-items: flex-start;
        }


        .role-name {
            font-size: 0.8rem;
            color: #b0b0b0;
            margin-bottom: 0.2rem;
            display: flex; /* flexbox 활성화 */
            align-items: center; /* 세로 중앙 정렬 */
            /* 역할에 따라 justify-content 설정 */
        }

        /* 유저 메시지의 이름 컨테이너 (오른쪽 정렬) */
        .message-container.user .role-name {
            justify-content: flex-end; /* 내용을 오른쪽으로 모으기 */
        }

         /* 캐릭터 메시지의 이름 컨테이너 (왼쪽 정렬) */
        .message-container.bot .role-name {
            justify-content: flex-start; /* 내용을 왼쪽으로 모으기 */
        }

        /* 이름 텍스트를 담는 span에 대한 스타일 */
        .name-text {
             /* 이름 텍스트 스타일 */
             /* 역할에 따라 text-align 설정 */
        }

         /* 유저 메시지의 이름 텍스트 오른쪽 정렬 */
         .message-container.user .name-text {
             text-align: right;
         }

          /* 캐릭터 메시지의 이름 텍스트 왼쪽 정렬 (기본값) */
         .message-container.bot .name-text {
             text-align: left;
         }


        .message-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            max-width: 100%;
            word-break: break-word;
            line-height: 1.4;
            position: relative; /* 자식 요소의 absolute 위치 기준 */
            font-size: 1rem;
            /* 사용자 입력 줄바꿈 표시를 위한 설정 */
             white-space: normal;
             margin-bottom: 0; /* 말풍선 자체 하단 마진 제거 시도 */
         }
         /* 챗봇 메시지의 p 태그 하단 마진 제거 (더 세밀한 간격 제어) */
         .message-container.bot .message-bubble p {
             margin-bottom: 0;
         }


        .message-container.bot .message-bubble {
            background-color: #3a4a4a;
            color: #ffffff;
            border-radius: 1rem 1rem 1rem 0.3rem;
        }

        .message-container.user .message-bubble {
            background-color: #4a3a7a;
            color: #ffffff;
            border-radius: 1rem 1rem 0.3rem 1rem;
        }

        /* 마크다운 내부 스타일 (adjust as needed) */
        /* p 태그에 기본적인 하단 마진 부여 (말풍선 내 요소 간 간격) */
        .message-bubble p { margin: 0 0 0.5rem 0; }
        .message-bubble p:last-child { margin-bottom: 0; } /* 마지막 단락 하단 마진 제거 */
        .message-bubble ul, .message-bubble ol { padding-left: 1.5rem; margin: 0 0 0.5rem 0; }
        .message-bubble li { margin-bottom: 0.25rem; }
        .message-bubble code {
            background-color: #3a3a3a;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
         }
.message-bubble pre {
             background-color: #3a3a3a;
             padding: 0.75rem;
             border-radius: 4px;
             overflow-x: auto; /* 필요시 가로 스크롤바 유지 */
             margin: 0.5rem 0;
             white-space: pre-wrap; /* 공백 유지하며 줄바꿈 허용 */
             word-wrap: break-word; /* 긴 단어 강제 줄바꿈 */
             overflow-wrap: break-word; /* 표준 속성 */
         }
        .message-bubble pre code {
             background-color: transparent;
             padding: 0;
             border-radius: 0;
             font-size: 1rem;
        }
        .message-bubble blockquote {
             border-left: 4px solid #5a5a5a;
             padding-left: 1rem;
             margin: 0.5rem 0;
             color: #b0b0b0;
        }
         .message-bubble h1, .message-bubble h2, .message-bubble h3, .message-bubble h4, .message-bubble h5, .message-bubble h6 {
             margin-top: 1rem;
             margin-bottom: 0.5rem;
             padding-bottom: 0.2rem;
             border-bottom: 1px solid #4a4a4a;
             font-weight: bold;
             color: #ffffff;
         }
         .message-bubble h1 { font-size: 1.5rem; }
         .message-bubble h2 { font-size: 1.4rem; }
         .message-bubble h3 { font-size: 1.3rem; }
         .message-bubble h4 { font-size: 1.2rem; }
         .message-bubble h5 { font-size: 1.1rem; }
         .message-bubble h6 { font-size: 1rem; }


         /* 행동 묘사 스타일 */
         /* *별표* 로 감싸진 부분에 적용될 스타일 */
        .action-description {
             color: #b0b0b0;
             font-style: italic;
         }
         /* 대사 스타일 */
         /* "따옴표" 로 감싸진 부분에 적용될 스타일 */
        .dialogue {
             font-weight: bold;
         }


        .message-image-thumbnail {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            object-fit: cover;
            cursor: pointer;
            margin-top: 0.2rem;
            border: 1px solid #5a5a5a;
        }

         .message-image-thumbnail.error {
             background-color: #5a5a5a;
         }

#inputArea {
            display: flex;
            padding: 1rem 1.5rem 2rem 1.5rem; /* 위: 1rem, 오른쪽: 1.5rem, 아래: 2rem, 왼쪽: 1.5rem */
            background-color: #1E1E1E;
            /* border-top: 1px solid #3a3a3a; */ /* 구분선 제거 */
            align-items: center;
            gap: 0.75rem;
             flex-shrink: 0;
             position: relative;
             /* 상단에 그림자 추가 */
             box-shadow: 0 -20px 20px 0px rgba(30, 30, 30); /* 위쪽으로 퍼지는 그림자 */
             z-index: 1; /* 그림자가 채팅 내용 위로 오도록 설정 */
        }

        #actionMenuButton {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #5a5a5a;
            color: #ffffff;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        #actionMenuButton:hover {
            background-color: #6a6a6a;
        }


        /* textarea 스타일 수정: 스크롤바 제거 및 모서리 둥글게 */
        #userInput {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 1.5rem; /* 둥글게 */
            border: none;
            background-color: #3a3a3a;
            color: #e0e0e0;
            font-size: 1rem;
            outline: none;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            resize: none; /* 크기 조절 비활성화 */
            line-height: 1.4; /* input과 유사하게 행간 설정 */
            box-sizing: border-box; /* padding 포함하여 크기 계산 */
            /* height: 40px; */ /* 초기 높이 설정을 더 이상 사용하지 않음 */
            min-height: calc(1em * 1.4 * 2 + 0.75rem * 2); /* 최소 높이: 폰트 크기(em) * 행간 * 2줄 + 상하 패딩 */
            height: auto; /* 내용에 따라 높이 자동 조절을 완전히 비활성화하지 않고 최소 높이 이상으로만 */
            overflow-y: auto; /* 높이가 2줄을 넘어가면 스크롤바 표시 */
            padding-top: 0.75rem; /* 상하 패딩 조정 */
            padding-bottom: 0.75rem;
        }

        #userInput:focus {
            background-color: #4a4a4a;
            box-shadow: 0 0 0 0.15rem rgba(80, 150, 255, 0.3);
        }

        #sendButton {
            padding: 0.75rem 1.5rem;
            border-radius: 1.5rem; /* 둥글게 */
            background-color: #5080ff;
            color: #ffffff;
            font-size: 1rem;
            font-weight: bold;
            min-width: 6rem;
            flex-shrink: 0;
             border: none;
             cursor: pointer;
         }
         #sendButton:hover { background-color: #6699ff; }
         #sendButton:active { background-color: #3366cc; }
         #sendButton:disabled {
            background-color: #4a4a4a;
            color: #b0b0b0;
            cursor: not-allowed;
         }

        .settings-area {
            display: none;
         }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 490;
            display: none;
         }

        #actionMenu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
             max-height: 0;
            background-color: #1E1E1E;
            color: #e0e0e0;
            border-top: 1px solid #3a3a3a;
            padding: 0 1rem;
            overflow-y: auto;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            z-index: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
         }

        #actionMenu.visible {
            max-height: 300px;
            padding: 1rem;
         }

        #actionMenu .menu-buttons {
            display: flex;
            flex-wrap: nowrap;
            gap: 0.75rem;
            justify-content: center;
            width: 100%;
            padding-bottom: 1rem;
             overflow-x: auto;
             padding-top: 1rem;
         }

         #actionMenu .menu-buttons::-webkit-scrollbar { display: none; }
         #actionMenu .menu-buttons { -ms-overflow-style: none; } /* IE and Edge */


        /* 액션 메뉴 버튼 스타일 수정: 원형으로 */
        #actionMenu button {
            flex-shrink: 0;
            flex-basis: auto;
            max-width: none;
             width: 60px; /* 가로세로 동일하게 */
             height: 60px; /* 가로세로 동일하게 */
             border-radius: 50%; /* 원형으로 */
            border: none;
            background-color: #3a3a3a;
            color: #e0e0e0;
            font-size: 0.8rem; /* 폰트 크기 조정 */
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
             flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
             line-height: 1.2;
             word-break: keep-all;
             padding: 0; /* 패딩 제거 또는 조정 */
        }
         #actionMenu button:hover {
             background-color: #4a4a4a;
         }


        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
            margin-left: 1rem;
            flex-shrink: 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 초기 공지 스타일 */
        .initial-notice {
    text-align: center; /* 중앙 정렬 */
    margin: 0.1rem auto 0.1rem auto; /* 위, 아래 여백 및 중앙 정렬 */
    color: #515151; /* 글자색 변경 */
    font-size: 0.9rem; /* 글자 크기 줄임 */
    padding: 1rem;
    max-width: 80%; /* 너무 길어지지 않도록 최대 너비 설정 */
    word-break: break-word;
         }

        /* 공지 아래 구분선 스타일 */
        .notice-divider {
            width: 90%; /* 가로선 너비 */
            height: 1px;
            background-color: #3a3a3a; /* 구분선 색상 */
            margin: 0.5rem auto 1.5rem auto; /* 위, 아래 여백 및 중앙 정렬 */
        }


        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none; /* Initially hidden */
            cursor: pointer;
        }

        .overlay img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
        }

        #sidebar {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: #1f1f1f;
            color: #e0e0e0;
            border-left: 1px solid #3a3a3a;
            transition: right 0.3s ease-out;
            z-index: 900;
            padding: 1rem;
            box-sizing: border-box;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            /* 스크롤바 스타일 */
            scrollbar-width: thin;
            scrollbar-color: #5a5a5a #1f1f1f; /* 썸네일색 트랙색 */
        }
        /* Webkit 브라우저용 스크롤바 스타일 */
        #sidebar::-webkit-scrollbar { width: 8px; }
        #sidebar::-webkit-scrollbar-track { background: #1f1f1f; }
        #sidebar::-webkit-scrollbar-thumb {
            background-color: #5a5a5a;
            border-radius: 4px;
            border: 2px solid #1f1f1f;
        }


        #sidebar.visible {
            right: 0;
        }

         .sidebar-header {
             font-size: 1.1rem;
             font-weight: bold;
             margin-bottom: 1rem;
             padding-bottom: 0.5rem;
             border-bottom: 1px solid #3a3a3a;
         }

         .sidebar-content label {
             display: block;
             margin-bottom: 0.5rem;
             font-weight: bold;
             color: #b0b0b0;
         }

         /* 설정 입력 칸 스타일 수정: 모서리 둥글게 */
         .sidebar-content input[type="text"],
         .sidebar-content textarea {
             width: 100%;
             padding: 0.75rem;
             border: none;
             border-radius: 8px; /* 더 둥글게 */
             background-color: #3a3a3a;
             color: #e0e0e0;
             font-size: 1rem;
             margin-bottom: 1rem;
             box-sizing: border-box;
             resize: vertical;
         }

         .sidebar-content textarea {
             min-height: 150px;
         }

         .sidebar-save-button {
             display: block;
             width: 100%;
             padding: 0.75rem;
             border: none;
             border-radius: 4px;
             background-color: #5080ff;
             color: #ffffff;
             font-size: 1rem;
             font-weight: bold;
             cursor: pointer;
             transition: background-color 0.2s ease;
             text-align: center;
         }
         .sidebar-save-button:hover {
             background-color: #6699ff;
         }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 890;
            display: none;
         }

        .sidebar-section-divider {
             height: 1px;
             background-color: #3a3a3a;
             margin: 1.5rem 0;
        }

        /* 설정 슬롯 버튼 스타일 */
        .setting-slots {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #3a3a3a;
        }

        .setting-slots h3 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            color: #b0b0b0;
        }

        .slot-buttons-container {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .slot-button {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #5a5a5a;
            color: #ffffff;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease, transform 0.1s ease;
            flex-shrink: 0;
        }

        .slot-button:hover {
            background-color: #6a6a6a;
        }

        .slot-button.active {
            background-color: #5080ff;
            transform: scale(1.1);
        }
         .slot-button:active {
             background-color: #3366cc;
         }

  .delete-btn {
    background: transparent;
    border: none;
    color: #aaa;
    font-size: 1rem;
    cursor: pointer;
    /* position: absolute; */ /* 절대 위치 제거 */
    /* top: 8px; right: 8px; */ /* 위치 속성 제거 */
    padding: 0 0.2rem; /* 버튼 내부 패딩 조정 */
    z-index: 1; /* 다른 요소 위에 오도록 z-index 유지 */
    flex-shrink: 0; /* 이름이 길어져도 버튼 크기 고정 */
    /* 이름과의 간격 및 위치는 아래 역할별 CSS에서 설정 */
  }

    /* 캐릭터 메시지의 삭제 버튼 (이름 오른쪽에 10px 간격) */
   .message-container.bot .role-name .delete-btn {
        margin-left: 10px; /* 이름과의 간격 */
        order: 1; /* 이름(order 0) 뒤에 오도록 */
    }

    /* 유저 메시지의 삭제 버튼 (이름 왼쪽에 10px 간격) */
    .message-container.user .role-name .delete-btn {
        margin-right: 10px; /* 이름과의 간격 */
        order: 0; /* 이름(order 1) 앞에 오도록 */
    }

    /* 유저 메시지에서 이름 텍스트 순서 조정 */
    .message-container.user .role-name .name-text {
        order: 1; /* 삭제 버튼(order 0) 뒤에 오도록 */
    }


  .message-container {
    position: relative;
  }
    </style>